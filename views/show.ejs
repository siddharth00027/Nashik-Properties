<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nashik Properties</title>
    <link rel="stylesheet" href="/css/style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous" />

    <!-- for mapbox setup -->
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
        integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <link href='https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/css/bootstrap.min.css' rel='stylesheet'>
    <link href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.0.3/css/font-awesome.css' rel='stylesheet'>

    <script type='text/javascript' src=''></script>
    <script type='text/javascript' src='https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js'></script>
    <script type='text/javascript'
        src='https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/js/bootstrap.min.js'></script>


</head>


<body>

    <%-include("./includes/navbar.ejs")%>
        <div class="container">
            <%-include("./includes/flash.ejs") %>
            <script>
                const mapToken = '<%=process.env.MAP_TOKEN%>';    
                   const listing=<%-JSON.stringify(listing)%>;
           
                </script>
               <div class="row mt-3">
                   <div class="col-8 offset-3">
                       <h3>
                           <%=listing.title%>
                       </h3>
                   </div>
                   <div class="card col-6 offset-3 show-card listing-card">
                       <img src="<%=listing.image.url %>" class="card-img-top show-img" alt="listing_image">
                       <div class="card-body">
                           <p class="card-text">Owned by :<i>
                                   <%=listing.owner.username  %>
                                   <!-- listing.owner.username -->
                               </i></p>
           
                           <p class="card-text">
                               <%=listing.description%>
                           </p>
           
                           <p class="card-text"> &#8377;<%=listing.price.toLocaleString("en-IN") %> </p>
           
                           <p class="card-text">
                               <%=listing.location%>
                           </p>
                           <!-- listing.price.toLocaleString("en-IN") -->
                           <p class="card-text">
                               <%=listing.country%>
                           </p>
           
                       </div>
                   </div>
                   <br>
           
               </div>
               <% if ( currentUser && currentUser._id.equals(listing.owner._id)) { %>
                   <div class="btns">
                       <a href="/listings/<%=listing._id %>/edit" class="btn btn-dark col-1 offset-3 edit-btn">Edit</a>
           
                       <form method="post" action="/listings/<%=listing._id %>?_method=DELETE">
                           <button class="btn btn-dark  offset-5">Delete</button>
                       </form>
                   </div>
                   <% } %>
                       
           
                       <!-- CREATE A REVIEW FORM for LISTING -->
                       <% if (currentUser) { %>
                           <div class="col-8 offset-3">
                               <hr>
                               <h4>Leave a review</h4>
                               <form action="/listings/<%=listing.id %>/reviews" method="post" novalidate class="needs-validation">
                                   <div class="mb-3 mt-3">
                                       <label for="review[rating]">Give rate out of 5</label>
                                       <input type="range" min="1" max="5" name="review[rating]">
                                       <label for="comment" class="form-label">Comment:</label>
                                       <textarea id="comment" name="review[comment]" cols="30" rows="5"
                                           class="form-control"></textarea>
                                       <div class="invalid-feedback">please submit some comments for review</div>
                                   </div>
                                   <br>
                                   <button class="btn btn-dark">submit</button>
           
                               </form>
                           </div>
                           <% } %>
           
                               <% if (listing.reviews.length>0) { %>
                                   <div class="col-8 offset-3">
                                       <p><b>All reviews</b></p>
                                       <div class="row">
           
                                           <% for( review of listing.reviews ) { %>
                                               <div class="card col-5 ms-3 mb-3 ">
                                                   <div class="card-body">
                                                       <h5 class="card-title">@<%=review.givenBy.username %>
                                                       </h5>
                                                       <p class="starability-result card-text" data-rating="<%=review.rating %>">
                                                       </p>
                                                       <% for( let index=0; index < review.rating ; index++ ) { %>
                                                           &#9733;
                                                           <% } %>
           
                                                               <p class="card-text">
                                                                   <%=review.comment %>
                                                               </p>
                                                              
                                                               <% if (currentUser && currentUser==review.givenBy) { %>
                                                                   <form method="post" class="mb-3 mt-3"
                                                                       action="/listings/<%=listing._id %>/reviews/<%=review._id %>?_method=DELETE">
                                                                       <button class="btn btn-dark"> Delete</button>
                                                                   </form>
                       
                                                               <% } %>
                                                             
                                                   </div>
                                                   
           
                                               </div>
                                               <% } %>
                                           
                                       </div>
                                   </div>
                                   <% } %>
                                       <!-- for the showing Map -->
                                       <div class="col-8 offset-3 mb-3">
                                           <hr>
                                           <h3>
                                               Where you'll be
                                           </h3>
                                           <div id="map"></div>
           
           
           
                                       </div>
                                       <script src="/js/map.js"></script>
                                       <!-- # https://docs.mapbox.com/mapbox-gl-js/example/setstyle/ -->
        </div>
        <%-include("./includes/footer.ejs") %>
       


            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>
    